language: go
dist: bionic

go:
  - 1.16.x

env:
  global:
    - CC_TEST_REPORTER_ID=9311a4b76692580fa889c7d2476a621b41f7ffb5554b8dabc5e818e572d0602c

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y libpcap-dev
  - env

before_script:
  - go get github.com/mattn/goveralls
  - go get github.com/AlekSi/gocoverutil
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build

go_import_path: github.com/hyeoncheon/goul

script:
  - >
    go mod tidy &&
    cat go.mod go.sum &&
    go build -o goul -ldflags "-X main.buildNumber=`git rev-parse --short HEAD`" ./cmd/goul &&
    ls -l goul &&
    ./goul -v &&
    ./supports/test-gocover.sh &&
    go test ./... -v &&
    goveralls -v -service=travis-ci

# cover.out was generated by test-gocover.sh, github.com/AlekSi/gocoverutil
after_script:
  - cp cover.out c.out
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
